/*@bgen(jjtree) Generated By:JJTree: Do not edit this line. DOTParser.jj */
/*@egen*//*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

options {
  // Generate non-static functions
  STATIC = false;
  // Case is ignored in keywords
  IGNORE_CASE = true;
}

PARSER_BEGIN(DOTParser)

package org.apache.pig.test.utils.dotGraph.parser;

import java.util.Map;
import java.util.HashMap;

import org.apache.pig.test.utils.dotGraph.DotGraph;
import org.apache.pig.test.utils.dotGraph.DotNode;
import org.apache.pig.test.utils.dotGraph.DotEdge;
import org.apache.pig.test.utils.dotGraph.DotGraphReader;

public class DOTParser/*@bgen(jjtree)*/implements DOTParserTreeConstants/*@egen*/ {/*@bgen(jjtree)*/
  protected JJTDOTParserState jjtree = new JJTDOTParserState();

/*@egen*/
    public static Map<String, DotNode> nodeMap = new HashMap<String, DotNode>();

    static String unquote(String s) {
        return s.substring(1, s.length()-1);
    }

    public static DotNode getNodeByName(String name) {
        DotNode node = nodeMap.get(name);
        if (node == null) {
            node = new DotNode(name);
            nodeMap.put(name, node);
        }
        return node;
    }
}

PARSER_END(DOTParser)

// Skip all the new lines, tabs and spaces
SKIP : { " " |	"\r" |	"\t" |	"\n" }

MORE :
{
  "//" : SINGLE_COMMENT
  |
  "#" : SINGLE_COMMENT
  |
  "/*" : MULTI_COMMENT
}

<MULTI_COMMENT> SPECIAL_TOKEN  :
{
	<("\n" | "\r" | "\r\n")>
	|
	<"*/"> : DEFAULT
}

<SINGLE_COMMENT> SPECIAL_TOKEN :
{
  < ("\n" | "\r" | "\r\n") > : DEFAULT
}

<MULTI_COMMENT> MORE :
{
	< ~[] >
}

<SINGLE_COMMENT> MORE :
{
	< ~[] >
}


TOKEN:
{

      <LPAREN : "{">
    | <RPAREN : "}">
    | <LSQBRACKET: "[">
    | <RSQBRACKET: "]">
    | <EQUAL: "=">
    | <COMMA: ",">
    | <SEMICOLON: ";">
    | <DIRECTED_EDGE: "->">
    | <EDGE: "edge">
    | <NODE: "node">
    | <GRAPH: "graph">
    | <DIGRAPH : "digraph">
    | <SUBGRAPH : "subgraph">
    | <#LETTER : ["a"-"z", "A"-"Z"] >
    | <#DIGIT : ["0"-"9"] >
    | <#SPECIAL_CHAR : "_" | "$" >
    | <NAME :  <LETTER> ( <LETTER> | <DIGIT> | <SPECIAL_CHAR> )* >
    | <NUMBER : ( <DIGIT> )+ >
    | <QUOTEDSTRING : "\"" (~["\""])* "\"">
}

DotGraph Parse() :
{/*@bgen(jjtree) Parse */
    SimpleNode jjtn000 = new SimpleNode(JJTPARSE);
    boolean jjtc000 = true;
    jjtree.openNodeScope(jjtn000);
/*@egen*/
    DotGraph dotGraph = null ;
	Token graphName ;
}
{/*@bgen(jjtree) Parse */
        try {
/*@egen*/
	(
		<DIGRAPH>
		(graphName = <NAME> { dotGraph = new DotGraph(graphName.image); dotGraph.topLevel = true; })?
		<LPAREN>
        StatementList(dotGraph)
		<RPAREN>
	)/*@bgen(jjtree)*/
        {
          jjtree.closeNodeScope(jjtn000, true);
          jjtc000 = false;
        }
/*@egen*/
	{ return dotGraph ; }/*@bgen(jjtree)*/
        } catch (Throwable jjte000) {
          if (jjtc000) {
            jjtree.clearNodeScope(jjtn000);
            jjtc000 = false;
          } else {
            jjtree.popNode();
          }
          if (jjte000 instanceof RuntimeException) {
            throw (RuntimeException)jjte000;
          }
          if (jjte000 instanceof ParseException) {
            throw (ParseException)jjte000;
          }
          throw (Error)jjte000;
        } finally {
          if (jjtc000) {
            jjtree.closeNodeScope(jjtn000, true);
          }
        }
/*@egen*/
}

void StatementList(DotGraph dotGraph) :
{/*@bgen(jjtree) StatementList */
    SimpleNode jjtn000 = new SimpleNode(JJTSTATEMENTLIST);
    boolean jjtc000 = true;
    jjtree.openNodeScope(jjtn000);
/*@egen*/
    ;
}
{/*@bgen(jjtree) StatementList */
    try {
/*@egen*/
    (
    Statement(dotGraph)
    )+/*@bgen(jjtree)*/
    } catch (Throwable jjte000) {
      if (jjtc000) {
        jjtree.clearNodeScope(jjtn000);
        jjtc000 = false;
      } else {
        jjtree.popNode();
      }
      if (jjte000 instanceof RuntimeException) {
        throw (RuntimeException)jjte000;
      }
      if (jjte000 instanceof ParseException) {
        throw (ParseException)jjte000;
      }
      throw (Error)jjte000;
    } finally {
      if (jjtc000) {
        jjtree.closeNodeScope(jjtn000, true);
      }
    }
/*@egen*/
}

void Statement(DotGraph dotGraph) :
{/*@bgen(jjtree) Statement */
    SimpleNode jjtn000 = new SimpleNode(JJTSTATEMENT);
    boolean jjtc000 = true;
    jjtree.openNodeScope(jjtn000);
/*@egen*/
    String[] attr;
    DotGraph subGraph;
}
{/*@bgen(jjtree) Statement */
    try {
/*@egen*/
    (
         LOOKAHEAD(2) EdgeStatement(dotGraph)
       | AttributeStatement(dotGraph)
       | LOOKAHEAD(2) ( attr = Attribute() ) { dotGraph.attributes.put(attr[0], attr[1]); }
       | LOOKAHEAD(2) NodeStatement(dotGraph)
       | subGraph = SubGraph() { dotGraph.nodes.add(subGraph); }
    )
    ( <SEMICOLON> )?/*@bgen(jjtree)*/
    } catch (Throwable jjte000) {
      if (jjtc000) {
        jjtree.clearNodeScope(jjtn000);
        jjtc000 = false;
      } else {
        jjtree.popNode();
      }
      if (jjte000 instanceof RuntimeException) {
        throw (RuntimeException)jjte000;
      }
      if (jjte000 instanceof ParseException) {
        throw (ParseException)jjte000;
      }
      throw (Error)jjte000;
    } finally {
      if (jjtc000) {
        jjtree.closeNodeScope(jjtn000, true);
      }
    }
/*@egen*/
}

DotGraph SubGraph() :
{/*@bgen(jjtree) SubGraph */
    SimpleNode jjtn000 = new SimpleNode(JJTSUBGRAPH);
    boolean jjtc000 = true;
    jjtree.openNodeScope(jjtn000);
/*@egen*/
    DotGraph dotGraph = null ;
    Token graphName ;
}
{/*@bgen(jjtree) SubGraph */
    try {
/*@egen*/
    <SUBGRAPH>
    graphName = <NAME> { dotGraph = new DotGraph(graphName.image); }
    <LPAREN>
    StatementList(dotGraph)
    <RPAREN>/*@bgen(jjtree)*/
    {
      jjtree.closeNodeScope(jjtn000, true);
      jjtc000 = false;
    }
/*@egen*/
    { return dotGraph; }/*@bgen(jjtree)*/
    } catch (Throwable jjte000) {
      if (jjtc000) {
        jjtree.clearNodeScope(jjtn000);
        jjtc000 = false;
      } else {
        jjtree.popNode();
      }
      if (jjte000 instanceof RuntimeException) {
        throw (RuntimeException)jjte000;
      }
      if (jjte000 instanceof ParseException) {
        throw (ParseException)jjte000;
      }
      throw (Error)jjte000;
    } finally {
      if (jjtc000) {
        jjtree.closeNodeScope(jjtn000, true);
      }
    }
/*@egen*/
}

void AttributeStatement(DotGraph dotGraph) :
{/*@bgen(jjtree) AttributeStatement */
    SimpleNode jjtn000 = new SimpleNode(JJTATTRIBUTESTATEMENT);
    boolean jjtc000 = true;
    jjtree.openNodeScope(jjtn000);
/*@egen*/
    Map<String,String> attributes ;
}
{/*@bgen(jjtree) AttributeStatement */
    try {
/*@egen*/
    (
      ( <EDGE> attributes = AttributeList()/*@bgen(jjtree)*/
                                            {
                                              jjtree.closeNodeScope(jjtn000, true);
                                              jjtc000 = false;
                                            }
/*@egen*/ { dotGraph.edgeAttributes = attributes; } )
    | ( <NODE> attributes = AttributeList()/*@bgen(jjtree)*/
                                            {
                                              jjtree.closeNodeScope(jjtn000, true);
                                              jjtc000 = false;
                                            }
/*@egen*/ { dotGraph.nodeAttributes = attributes; } )
    | ( <GRAPH> attributes = AttributeList()/*@bgen(jjtree)*/
                                             {
                                               jjtree.closeNodeScope(jjtn000, true);
                                               jjtc000 = false;
                                             }
/*@egen*/ { dotGraph.attributes = attributes ; } )
    )/*@bgen(jjtree)*/
    } catch (Throwable jjte000) {
      if (jjtc000) {
        jjtree.clearNodeScope(jjtn000);
        jjtc000 = false;
      } else {
        jjtree.popNode();
      }
      if (jjte000 instanceof RuntimeException) {
        throw (RuntimeException)jjte000;
      }
      if (jjte000 instanceof ParseException) {
        throw (ParseException)jjte000;
      }
      throw (Error)jjte000;
    } finally {
      if (jjtc000) {
        jjtree.closeNodeScope(jjtn000, true);
      }
    }
/*@egen*/
}

void NodeStatement(DotGraph dotGraph) :
{/*@bgen(jjtree) NodeStatement */
    SimpleNode jjtn000 = new SimpleNode(JJTNODESTATEMENT);
    boolean jjtc000 = true;
    jjtree.openNodeScope(jjtn000);
/*@egen*/
    String nodeName ;
    DotNode node ;
    Map<String,String> attributes ;
}
{/*@bgen(jjtree) NodeStatement */
    try {
/*@egen*/
    ( nodeName = NodeName() ) { node = getNodeByName(nodeName); }
    ( attributes = AttributeList()  {
                                        node.attributes = new HashMap<String,String>() ;
                                        node.attributes.putAll(attributes) ;
                                    }
    )?/*@bgen(jjtree)*/
    {
      jjtree.closeNodeScope(jjtn000, true);
      jjtc000 = false;
    }
/*@egen*/
    { dotGraph.nodes.add(node) ; }/*@bgen(jjtree)*/
    } catch (Throwable jjte000) {
      if (jjtc000) {
        jjtree.clearNodeScope(jjtn000);
        jjtc000 = false;
      } else {
        jjtree.popNode();
      }
      if (jjte000 instanceof RuntimeException) {
        throw (RuntimeException)jjte000;
      }
      if (jjte000 instanceof ParseException) {
        throw (ParseException)jjte000;
      }
      throw (Error)jjte000;
    } finally {
      if (jjtc000) {
        jjtree.closeNodeScope(jjtn000, true);
      }
    }
/*@egen*/
}

void EdgeStatement(DotGraph dotGraph) :
{/*@bgen(jjtree) EdgeStatement */
    SimpleNode jjtn000 = new SimpleNode(JJTEDGESTATEMENT);
    boolean jjtc000 = true;
    jjtree.openNodeScope(jjtn000);
/*@egen*/
    String nodeName1 ;
    String nodeName2 ;
    DotNode startingNode ;
    Map<String,String> attributes ;
    DotEdge edge = new DotEdge() ;
}
{/*@bgen(jjtree) EdgeStatement */
    try {
/*@egen*/
    nodeName1 = NodeName() { startingNode = getNodeByName(nodeName1) ; }
    (
     <DIRECTED_EDGE>
     nodeName2 = NodeName()
     {
        edge.fromNode = startingNode ;
        DotNode node2 = getNodeByName(nodeName2) ;
        edge.toNode = node2 ;

        dotGraph.nodes.add(startingNode);
        dotGraph.nodes.add(node2);
        dotGraph.edges.add(edge) ;

        if (startingNode != node2)
            startingNode.edgeTo.add(node2);

        startingNode = node2 ;
     }
    )+
    ( attributes = AttributeList()  {
                                        edge.attributes = new HashMap<String,String>() ;
                                        edge.attributes.putAll(attributes) ;
                                    }
    )?/*@bgen(jjtree)*/
    } catch (Throwable jjte000) {
      if (jjtc000) {
        jjtree.clearNodeScope(jjtn000);
        jjtc000 = false;
      } else {
        jjtree.popNode();
      }
      if (jjte000 instanceof RuntimeException) {
        throw (RuntimeException)jjte000;
      }
      if (jjte000 instanceof ParseException) {
        throw (ParseException)jjte000;
      }
      throw (Error)jjte000;
    } finally {
      if (jjtc000) {
        jjtree.closeNodeScope(jjtn000, true);
      }
    }
/*@egen*/
}

Map<String,String> AttributeList() :
{/*@bgen(jjtree) AttributeList */
    SimpleNode jjtn000 = new SimpleNode(JJTATTRIBUTELIST);
    boolean jjtc000 = true;
    jjtree.openNodeScope(jjtn000);
/*@egen*/
    Map<String,String> attributes = new HashMap<String,String>() ;
    String[] keyValuePair ;
}
{/*@bgen(jjtree) AttributeList */
    try {
/*@egen*/
    (
    <LSQBRACKET>
    (keyValuePair = Attribute() { attributes.put(keyValuePair[0], keyValuePair[1]) ; }  )
        (
            <COMMA>
            (keyValuePair = Attribute() { attributes.put(keyValuePair[0], keyValuePair[1]) ; }  )
        )*
    <RSQBRACKET>
    )/*@bgen(jjtree)*/
    {
      jjtree.closeNodeScope(jjtn000, true);
      jjtc000 = false;
    }
/*@egen*/
    { return attributes ; }/*@bgen(jjtree)*/
    } catch (Throwable jjte000) {
      if (jjtc000) {
        jjtree.clearNodeScope(jjtn000);
        jjtc000 = false;
      } else {
        jjtree.popNode();
      }
      if (jjte000 instanceof RuntimeException) {
        throw (RuntimeException)jjte000;
      }
      if (jjte000 instanceof ParseException) {
        throw (ParseException)jjte000;
      }
      throw (Error)jjte000;
    } finally {
      if (jjtc000) {
        jjtree.closeNodeScope(jjtn000, true);
      }
    }
/*@egen*/
}

String[] Attribute() :
{/*@bgen(jjtree) Attribute */
    SimpleNode jjtn000 = new SimpleNode(JJTATTRIBUTE);
    boolean jjtc000 = true;
    jjtree.openNodeScope(jjtn000);
/*@egen*/
    Token attName ;
    String value ;
    String[] keyValuePair = new String[2] ;
}
{/*@bgen(jjtree) Attribute */
    try {
/*@egen*/
    (
    attName = <NAME> { keyValuePair[0] = attName.image ; }
    <EQUAL>
    value = Value() { keyValuePair[1] = value; }
    )/*@bgen(jjtree)*/
    {
      jjtree.closeNodeScope(jjtn000, true);
      jjtc000 = false;
    }
/*@egen*/
    { return keyValuePair ; }/*@bgen(jjtree)*/
    } catch (Throwable jjte000) {
      if (jjtc000) {
        jjtree.clearNodeScope(jjtn000);
        jjtc000 = false;
      } else {
        jjtree.popNode();
      }
      if (jjte000 instanceof RuntimeException) {
        throw (RuntimeException)jjte000;
      }
      if (jjte000 instanceof ParseException) {
        throw (ParseException)jjte000;
      }
      throw (Error)jjte000;
    } finally {
      if (jjtc000) {
        jjtree.closeNodeScope(jjtn000, true);
      }
    }
/*@egen*/
}

String Value() :
{/*@bgen(jjtree) Value */
    SimpleNode jjtn000 = new SimpleNode(JJTVALUE);
    boolean jjtc000 = true;
    jjtree.openNodeScope(jjtn000);
/*@egen*/
    Token value;
}
{/*@bgen(jjtree) Value */
    try {
/*@egen*/
    (
      value = <QUOTEDSTRING>
      | value = <NAME>
      | value = <NUMBER>
    )/*@bgen(jjtree)*/
    {
      jjtree.closeNodeScope(jjtn000, true);
      jjtc000 = false;
    }
/*@egen*/
    { return value.image; }/*@bgen(jjtree)*/
    } finally {
      if (jjtc000) {
        jjtree.closeNodeScope(jjtn000, true);
      }
    }
/*@egen*/
}

String NodeName() :
{/*@bgen(jjtree) NodeName */
    SimpleNode jjtn000 = new SimpleNode(JJTNODENAME);
    boolean jjtc000 = true;
    jjtree.openNodeScope(jjtn000);
/*@egen*/
    Token name ;
}
{/*@bgen(jjtree) NodeName */
    try {
/*@egen*/
    (
          name = <NAME>
        | name = <NUMBER>
    )/*@bgen(jjtree)*/
    {
      jjtree.closeNodeScope(jjtn000, true);
      jjtc000 = false;
    }
/*@egen*/
    { return name.image; }/*@bgen(jjtree)*/
    } finally {
      if (jjtc000) {
        jjtree.closeNodeScope(jjtn000, true);
      }
    }
/*@egen*/
}
